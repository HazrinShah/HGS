<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    /* Cache bust: 2024-01-20 - Force sidebar positioning */
    :root {
      --primary-color: #3fd847;
      --secondary-color: #85fb5a;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --dark-color: #343a40;
      --light-color: #f8f9fa;
    }
    
    body {
      background-color: #f5f5f5;
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
    }

     /* Header */
    .navbar {
      background-color: #571785;
      padding: 12px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1002;
      width: 100%;
    }

    .navbar-title {
      font-size: 22px;
      font-weight: bold;
      color: rgb(255, 255, 255);
      margin: 0 auto;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }

    .logo {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }

    .sidebar {
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%) !important;
      position: fixed !important;
      top: 0 !important;
      left: -350px !important;
      width: 320px !important;
      height: 100vh !important;
      margin: 0 !important;
      padding: 100px 15px 20px 15px !important;
      border-radius: 0 !important;
      box-shadow: 0 8px 32px rgba(87, 23, 133, 0.4) !important;
      border: 2px solid rgba(255, 255, 255, 0.1) !important;
      z-index: 1000 !important;
      transition: left 0.3s ease !important;
      overflow-y: auto !important;
    }

    .sidebar.mobile-open { left: 0 !important; }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: inline-flex;
      position: static;
      z-index: 1001;
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px;
      font-size: 1.2rem;
      box-shadow: 0 4px 12px rgba(87, 23, 133, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      align-items: center;
      justify-content: center;
    }

    .mobile-menu-btn:hover {
      background: linear-gradient(135deg, #4a0f6b 0%, #3d0a5c 100%);
      transform: scale(1.05);
    }

    /* Mobile Overlay */
    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      transition: opacity 0.3s ease;
    }

    .mobile-overlay.show {
      display: block;
    }


    .sidebar .menu a {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: #ffffff;
      font-weight: 600;
      text-decoration: none;
      margin-bottom: 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
    }

    /* Shimmer highlight on hover */
    .sidebar .menu a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .sidebar .menu a:hover::before {
      left: 100%;
    }

    /* Active state matches AUser */
    .sidebar .menu a.active {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .sidebar .menu a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .sidebar .menu a:hover::before {
      left: 100%;
    }

    .sidebar .menu a:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .sidebar .menu a.active {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .sidebar .menu i {
      margin-right: 15px;
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    body { padding-top: 80px; }
    .main-content { flex-grow: 1; padding: 80px 15px 20px 15px; width: 100%; margin-left: 0; }

    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: static;
        padding: 10px 12px;
        z-index: 1001;
      }
      
      /* Make navbar fixed at top for mobile */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1002;
        width: 100%;
      }
      
      /* Adjust body padding to account for fixed navbar */
      body {
        padding-top: 80px;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: -350px;
        width: 320px;
        height: 100vh;
        margin: 0;
        border-radius: 0;
        z-index: 1000;
        transition: left 0.3s ease;
        overflow-y: auto;
        padding: 100px 15px 20px 15px !important;
      }

      .sidebar.mobile-open {
        left: 0 !important;
      }

      .wrapper {
        flex-direction: column;
      }

      .main-content {
        margin-left: 0;
        padding: 80px 15px 20px 15px;
        width: 100%;
      }
      
      /* Improve menu text readability on mobile */
      .sidebar .menu a {
        padding: 18px 20px;
        font-size: 16px;
        font-weight: 600;
      }
      
      .sidebar .menu i {
        margin-right: 18px;
        font-size: 20px;
        width: 24px;
      }
    }
    .wrapper { display: flex; min-height: 100vh; flex-direction: column; }
    
    .navbar.fixed-top {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      z-index: 1030;
    }

    .dashboard-title {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }
    
    /* Page Hero Header */
    .page-hero {
      background: linear-gradient(180deg, #f6f8ff 0%, #f7fbff 100%);
      border-radius: 20px;
      padding: 40px 20px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 6px 18px rgba(87, 23, 133, 0.06);
      border: 1px solid rgba(87, 23, 133, 0.08);
    }
    
    .page-hero-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0 0 8px 0;
      background: linear-gradient(135deg, #4a0f6b, #571785);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.2px;
    }
    
    .page-hero-subtitle {
      color: #64748b;
      font-weight: 500;
      font-size: 1.05rem;
      margin: 0;
    }

    .dashboard-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 20px;
      padding: 25px;
    height: 100%;
    width: 100%; 
    display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 8px 32px rgba(87, 23, 133, 0.15);
      margin-top: 20px;
      border: 2px solid rgba(87, 23, 133, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #571785, #4a0f6b, #3d0a5c);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(87, 23, 133, 0.25);
      border-color: #4a0f6b;
    }

    .chart-container {
      width: 100%;
      height: 280px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 15px;
        }

    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    /* Modern Colorful Stat Cards */
    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 30px 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: none;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      transition: height 0.3s ease;
    }

    .stat-card:nth-child(1)::before { background: linear-gradient(90deg, #571785, #4a0f6b); }
    .stat-card:nth-child(2)::before { background: linear-gradient(90deg, #571785, #4a0f6b); }
    .stat-card:nth-child(3)::before { background: linear-gradient(90deg, #571785, #4a0f6b); }
    .stat-card:nth-child(4)::before { background: linear-gradient(90deg, #571785, #4a0f6b); }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .stat-card:hover::before {
      height: 8px;
    }

    .stat-icon {
      width: 70px;
      height: 70px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      font-size: 28px;
      color: white;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stat-icon.revenue { 
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%);
    }
    .stat-icon.bookings { 
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%);
    }
    .stat-icon.users { 
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%);
    }
    .stat-icon.guiders { 
      background: linear-gradient(135deg, #571785 0%, #4a0f6b 100%);
    }

    .stat-number {
      font-size: 2.2rem;
      font-weight: 800;
      margin-bottom: 8px;
      line-height: 1;
      word-break: break-word;
    }

    .stat-card:nth-child(1) .stat-number { color: #571785; }
    .stat-card:nth-child(2) .stat-number { color: #571785; }
    .stat-card:nth-child(3) .stat-number { color: #571785; }
    .stat-card:nth-child(4) .stat-number { color: #571785; }

    .stat-label {
      font-size: 0.875rem;
      color: #64748b;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .stat-change {
      font-size: 0.875rem;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 20px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive { 
      color: #059669;
      background: #d1fae5;
    }
    .stat-change.negative { 
      color: #dc2626;
      background: #fee2e2;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 18px;
      font-weight: 700;
      color: #571785;
      margin: 0;
    }

    .chart-subtitle {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .filter-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-controls select {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(87, 23, 133, 0.2);
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 14px;
      color: #571785;
      min-width: 120px;
      transition: all 0.3s ease;
    }

    .filter-controls select:focus {
      outline: none;
      border-color: #571785;
      box-shadow: 0 0 0 2px rgba(87, 23, 133, 0.1);
    }

    .filter-controls select:hover {
      border-color: #571785;
    }

    .logout-btn {
      margin-top: 30px;
    }
  </style>
</head>
<body>


  <div class="mobile-overlay" onclick="closeMobileMenu()"></div>


    <header>
    <nav class="navbar fixed-top">
        <div class="container d-flex align-items-center">
        
        <button class="mobile-menu-btn me-2" onclick="toggleMobileMenu()">
          <i class="bi bi-list"></i>
        </button>
        
        <a class="navbar-brand d-flex align-items-center" href="../">
            <img src="../img/logo.png" class="img-fluid logo me-2" alt="HGS Logo" style="width: 50px; height: 50px;">
            <span class="fs-6 fw-bold text-white">Admin</span>
        </a>

        
        <h1 class="navbar-title ms-auto me-auto">HIKING GUIDANCE SYSTEM</h1>
        </div>
    </nav>
    </header>
    


  <div class="wrapper">
    
    <div class="sidebar">
        <div class="logo-admin">
        <strong class="ms-2 text-white">Menu</strong>
        </div>
        <div class="menu mt-4">
        <a href="ADashboard.html" class="active"><i class="bi bi-grid-fill"></i> Dashboard</a>
        <a href="AUser.html"><i class="bi bi-people-fill"></i> User</a>
        <a href="AMountain.php"><i class="bi bi-triangle-fill"></i> Mountain</a>
        <a href="AAppeal.php"><i class="bi bi-chat-dots-fill"></i> Appeal</a>
        <a href="ASentimentReport.php"><i class="fas fa-chart-line"></i> Sentiment Analysis</a>
        <a href="AReport.php"><i class="bi bi-file-earmark-text-fill"></i> Reports</a>
        <div class="text-center mt-4">
            <form action="../shared/logout.php" method="POST" class="d-flex justify-content-center">
                <button class="btn btn-danger logout-btn w-50" type="submit">
                <i class="bi bi-box-arrow-right"></i> Log Out
                </button>
            </form>
        </div>
        </div>
    </div>

    
    <div class="main-content">
    <div class="container">
        
        <!-- Page Hero Header -->
        <div class="page-hero">
            <h1 class="page-hero-title">
                <i class="fas fa-chart-pie"></i> Admin Dashboard
            </h1>
            <p class="page-hero-subtitle">Real-time overview of your hiking guidance system</p>
        </div>
        
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon revenue">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <div class="stat-number" id="totalRevenue">$0</div>
                <div class="stat-label">Total Income</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon bookings">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <div class="stat-number" id="totalBookings">0</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon users">
                    <i class="bi bi-people"></i>
                </div>
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Active Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon guiders">
                    <i class="bi bi-person-badge"></i>
                </div>
                <div class="stat-number" id="activeGuiders">0</div>
                <div class="stat-label">Active Guiders</div>
            </div>
        </div>


        <div class="row g-4">
        <div class="col-lg-8">
            <div class="dashboard-card">
                <div class="chart-header">
            <div>
                        <div class="chart-title">Revenue Trends</div>
                        <div class="chart-subtitle">Monthly revenue over the last 6 months</div>
                    </div>
                    <div class="filter-controls">
                        <select id="yearFilter" class="form-select">
                            <option value="">All Years</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                        <select id="monthFilter" class="form-select">
                            <option value="">All Months</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
            </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="dashboard-card">
                <div class="chart-header">
            <div>
                        <div class="chart-title">Booking Status</div>
                        <div class="chart-subtitle">Current booking distribution</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="bookingStatusChart"></canvas>
            </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="dashboard-card">
                <div class="chart-header">
            <div>
                        <div class="chart-title">Top Performing Guiders</div>
                        <div class="chart-subtitle">Guiders ranked by ratings and bookings</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="guiderPerformanceChart"></canvas>
            </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="dashboard-card">
                <div class="chart-header">
            <div>
                        <div class="chart-title">User Activity</div>
                        <div class="chart-subtitle">Active users by month (based on bookings)</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="userGrowthChart"></canvas>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

  Chart.defaults.font.family = 'Montserrat, sans-serif';
  Chart.defaults.color = '#571785';

  let dashboardData = null;
  let charts = {};

  async function fetchDashboardData(year = '', month = '') {
    try {
      let url = 'ADashboardData.php';
      const params = new URLSearchParams();
      if (year) params.append('year', year);
      if (month) params.append('month', month);
      if (params.toString()) url += '?' + params.toString();

      const response = await fetch(url);
      if (!response.ok) {
        throw new Error('Failed to fetch data');
      }
      dashboardData = await response.json();
      updateStats();
      createCharts();
    } catch (error) {
      console.error('Error fetching dashboard data:', error);
      createDummyCharts();
    }
  }

  function updateStats() {
    if (!dashboardData) return;

    const totalRevenue = dashboardData.financial.total_revenue;
    document.getElementById('totalRevenue').textContent = 'RM' + totalRevenue.toLocaleString();

    const totalBookings = dashboardData.bookings.status_counts.reduce((sum, count) => sum + count, 0);
    document.getElementById('totalBookings').textContent = totalBookings.toLocaleString();

    const totalUsers = dashboardData.users.user_counts.reduce((sum, count) => sum + count, 0);
    document.getElementById('totalUsers').textContent = totalUsers.toLocaleString();

    const activeGuiders = dashboardData.performance.guider_names.length;
    document.getElementById('activeGuiders').textContent = activeGuiders;
  }
  function createRevenueChart() {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    if (charts.revenue) {
      charts.revenue.destroy();
    }
    charts.revenue = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dashboardData.financial.labels.length > 0 ? dashboardData.financial.labels : ['Current Month'],
        datasets: [{
          label: 'Revenue',
          data: dashboardData.financial.monthly_revenue.length > 0 ? dashboardData.financial.monthly_revenue : [dashboardData.financial.total_revenue],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.2)',
          borderWidth: 3,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#059669',
          pointBorderColor: '#10b981',
          pointBorderWidth: 3,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(16, 185, 129, 0.1)'
            },
            ticks: {
              callback: function(value) {
                return 'RM' + (value / 1000) + 'K';
              },
              color: '#059669'
            }
          },
          x: {
            grid: {
              color: 'rgba(16, 185, 129, 0.1)'
            },
            ticks: {
              color: '#059669'
            }
          }
        }
      }
    });
  }

  
  function createBookingStatusChart() {
    const ctx = document.getElementById('bookingStatusChart').getContext('2d');
    
    // Define color mapping for each status
    const statusColorMap = {
      'Completed': '#10b981',   // Green
      'Pending': '#f59e0b',     // Yellow
      'Cancelled': '#ef4444',   // Red
      'In Progress': '#3b82f6'  // Blue
    };
    
    // Map colors based on actual status labels from backend
    const labels = dashboardData.bookings.status_labels || ['Completed', 'Pending', 'Cancelled', 'In Progress'];
    const colors = labels.map(label => statusColorMap[label] || '#6b7280');
    
    charts.bookingStatus = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: dashboardData.bookings.status_counts || [45, 25, 15, 10],
          backgroundColor: colors,
          borderWidth: 4,
          borderColor: '#fff',
          hoverOffset: 15,
          hoverBorderWidth: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              usePointStyle: true,
              font: {
                size: 13,
                weight: '600'
              },
              color: '#1f2937'
            }
          }
        }
      }
    });
  }

  function createGuiderPerformanceChart() {
    const ctx = document.getElementById('guiderPerformanceChart').getContext('2d');
    charts.guiderPerformance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: dashboardData.performance.guider_names.slice(0, 5) || ['John Doe', 'Jane Smith', 'Mike Johnson', 'Sarah Wilson', 'David Brown'],
        datasets: [{
          label: 'Rating',
          data: dashboardData.performance.guider_ratings.slice(0, 5) || [4.8, 4.6, 4.4, 4.2, 4.0],
          backgroundColor: [
            'rgba(236, 72, 153, 0.8)',   // Pink
            'rgba(139, 92, 246, 0.8)',   // Purple
            'rgba(59, 130, 246, 0.8)',   // Blue
            'rgba(16, 185, 129, 0.8)',   // Green
            'rgba(245, 158, 11, 0.8)'    // Orange
          ],
          borderRadius: 10,
          borderSkipped: false,
          barThickness: 30
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: 'y',
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          x: {
            beginAtZero: true,
            max: 5,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            ticks: {
              stepSize: 1,
              color: '#64748b'
            }
          },
          y: {
            grid: {
              display: false
            },
            ticks: {
              color: '#1f2937',
              font: {
                weight: '600'
              }
            }
          }
        }
      }
    });
  }

  // Create User Growth Chart (Bar Chart)
  function createUserGrowthChart() {
    const ctx = document.getElementById('userGrowthChart').getContext('2d');
    charts.userGrowth = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: dashboardData.user_growth.month_labels.length > 0 ? 
                dashboardData.user_growth.month_labels : 
                ['Sep 2025', 'Aug 2025', 'Jul 2025', 'Jun 2025'],
        datasets: [{
          label: 'Active Users',
          data: dashboardData.user_growth.month_counts.length > 0 ? 
                dashboardData.user_growth.month_counts : 
                [0, 0, 0, 0],
          backgroundColor: [
            'rgba(59, 130, 246, 0.8)',   // Blue
            'rgba(96, 165, 250, 0.8)',   // Light Blue
            'rgba(147, 197, 253, 0.8)',  // Lighter Blue
            'rgba(191, 219, 254, 0.8)'   // Very Light Blue
          ],
          borderRadius: 10,
          borderSkipped: false,
          barThickness: 40
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1,
              callback: function(value) {
                return Math.floor(value);
              },
              color: '#64748b',
              font: {
                weight: '600'
              }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          },
          x: {
            grid: {
              display: false
            },
            ticks: {
              color: '#1f2937',
              font: {
                weight: '600'
              }
            }
          }
        }
      }
    });
  }

  // Create all charts with real data
  function createCharts() {
    if (!dashboardData) return;
    
    createRevenueChart();
    createBookingStatusChart();
    createGuiderPerformanceChart();
    createUserGrowthChart();
  }

  // standby kalau API fail keluar dummy stat
  function createDummyCharts() {
    // Revenue Chart
    new Chart(document.getElementById('revenueChart'), {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'Revenue',
          data: [12000, 15000, 18000, 14000, 22000, 25000],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.2)',
          borderWidth: 3,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#059669',
          pointBorderColor: '#10b981'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { 
            beginAtZero: true,
            grid: { color: 'rgba(16, 185, 129, 0.1)' },
            ticks: { color: '#059669' }
          },
          x: { 
            grid: { color: 'rgba(16, 185, 129, 0.1)' },
            ticks: { color: '#059669' }
          }
        }
      }
    });

    // Booking Status Chart
    const statusColorMap = {
      'Completed': '#10b981',   // Green
      'Pending': '#f59e0b',     // Yellow
      'Cancelled': '#ef4444',   // Red
      'In Progress': '#3b82f6'  // Blue
    };
    
    const dummyLabels = ['Completed', 'Pending', 'Cancelled', 'In Progress'];
    const dummyColors = dummyLabels.map(label => statusColorMap[label]);
    
    new Chart(document.getElementById('bookingStatusChart'), {
      type: 'doughnut',
      data: {
        labels: dummyLabels,
        datasets: [{
          data: [45, 25, 15, 10],
          backgroundColor: dummyColors,
          borderWidth: 4,
          borderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { 
          legend: { 
            position: 'bottom',
            labels: {
              color: '#1f2937',
              font: { weight: '600' }
            }
          } 
        }
      }
    });

    // Guider Performance Chart
    new Chart(document.getElementById('guiderPerformanceChart'), {
      type: 'bar',
      data: {
        labels: ['John Doe', 'Jane Smith', 'Mike Johnson', 'Sarah Wilson', 'David Brown'],
        datasets: [{
          label: 'Rating',
          data: [4.8, 4.6, 4.4, 4.2, 4.0],
          backgroundColor: [
            'rgba(236, 72, 153, 0.8)',
            'rgba(139, 92, 246, 0.8)',
            'rgba(59, 130, 246, 0.8)',
            'rgba(16, 185, 129, 0.8)',
            'rgba(245, 158, 11, 0.8)'
          ],
          borderRadius: 10,
          barThickness: 30
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: { 
          x: { 
            beginAtZero: true, 
            max: 5,
            grid: { color: 'rgba(0, 0, 0, 0.05)' },
            ticks: { color: '#64748b' }
          },
          y: {
            grid: { display: false },
            ticks: { color: '#1f2937', font: { weight: '600' } }
          }
        }
      }
    });

    // User Growth Chart
    new Chart(document.getElementById('userGrowthChart'), {
      type: 'bar',
      data: {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        datasets: [{
          label: 'New Users',
          data: [25, 35, 28, 42],
          backgroundColor: [
            'rgba(59, 130, 246, 0.8)',
            'rgba(96, 165, 250, 0.8)',
            'rgba(147, 197, 253, 0.8)',
            'rgba(191, 219, 254, 0.8)'
          ],
          borderRadius: 10,
          barThickness: 40
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { 
          y: { 
            beginAtZero: true,
            grid: { color: 'rgba(0, 0, 0, 0.05)' },
            ticks: { color: '#64748b', font: { weight: '600' } }
          },
          x: {
            grid: { display: false },
            ticks: { color: '#1f2937', font: { weight: '600' } }
          }
        }
      }
    });
  }

  // Initialize dashboard
  document.addEventListener('DOMContentLoaded', function() {
    fetchDashboardData();
    
    // Add event listeners for filter controls
    document.getElementById('yearFilter').addEventListener('change', function() {
      const year = this.value;
      const month = document.getElementById('monthFilter').value;
      fetchDashboardData(year, month);
    });
    
    document.getElementById('monthFilter').addEventListener('change', function() {
      const month = this.value;
      const year = document.getElementById('yearFilter').value;
      fetchDashboardData(year, month);
    });
  });

  // Mobile menu toggle function (align with AUser)
  function toggleMobileMenu() {
    const sidebar = document.querySelector('.sidebar');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const overlay = document.querySelector('.mobile-overlay');
    if (!sidebar || !overlay) return;
    const isOpen = sidebar.classList.toggle('mobile-open');
    overlay.classList.toggle('show', isOpen);
    document.body.style.overflow = isOpen ? 'hidden' : 'auto';
    const icon = mobileBtn && mobileBtn.querySelector('i');
    if (icon) icon.className = isOpen ? 'bi bi-x' : 'bi bi-list';
  }

  // Close mobile menu function
  function closeMobileMenu() {
    const sidebar = document.querySelector('.sidebar');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const overlay = document.querySelector('.mobile-overlay');
    if (!sidebar || !overlay) return;
    sidebar.classList.remove('mobile-open');
    overlay.classList.remove('show');
    document.body.style.overflow = 'auto';
    const icon = mobileBtn && mobileBtn.querySelector('i');
    if (icon) icon.className = 'bi bi-list';
  }

  // Close mobile menu when clicking outside
  document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.sidebar');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    
    if (window.innerWidth <= 768) {
      if (!sidebar.contains(event.target) && !mobileBtn.contains(event.target)) {
        closeMobileMenu();
      }
    }
  });

  // Close mobile menu on window resize
  window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
      closeMobileMenu();
    }
  });

  // Close on ESC key (match AUser)
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeMobileMenu();
    }
  });

  // Close when any sidebar link is clicked (match AUser)
  document.querySelectorAll('.sidebar .menu a').forEach(function(a) {
    a.addEventListener('click', closeMobileMenu);
  });
</script>

  </div> <!-- End wrapper -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
